{% extends 'layouts.html' %}

{% block content %}

<div class="container-fluid ps-4">
    <div class="mt-2">
        <h4 class="mt-4">Admin Panel</h4>

        <!-- Ajouter le formulaire de filtre -->
        <div class="container mb-4">
            <form id="filter-form" onreset="updateRow()">
                <div class="row">
                    <div class="col-md-4">
                        <label for="author-filter">Published by:</label>
                        <select id="author-filter" class="form-select" name="author" onchange="updateRow()">
                            <option value="">All</option>
                            {% for user in users%}
                            <option value="{{user.id}}">{{user.firstname}} {{user.lastname}}</option>
                            {% endfor %}
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="difficulty-filter">Difficulty:</label>
                        <select id="difficulty-filter" class="form-select" name="difficulty" onchange="updateRow()">
                            <option value="">All</option>
                            <option value="Easy">Easy</option>
                            <option value="Intermediate">Intermediate</option>
                            <option value="Hard">Hard</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label for="status-filter">Status</label>
                        <select id="status-filter" class="form-select" name="status"  onchange="updateRow()">
                            <option value="">All</option>
                            <option value="Approved">Approved</option>
                            <option value="Not approved">Not approved</option>
                        </select>
                    </div>
                </div>
                <div class="row mt-3">
                    <div class="col-md-12 justify-content-center d-flex">
                        <button type="submit" class="btn btn-primary">Filter</button>
                        <button type="reset" class="btn btn-secondary ms-2">Reset</button>
                    </div>
                </div>
            </form>
        </div>

        <div class="container" id="filtered-results">
            <table class="table table-striped">
                <thead>
                    <th>Coktails Name</th>
                    <th>Published by</th>
                    <th>Difficulty</th>
                    <th>Status</th>
                    <th></th> 
                </thead>
                <tbody>
                    {% for cocktail in cocktails%}
                    <tr>
                        <td class="fw-bolder">{{cocktail.title}}</td>
                        <td>{{cocktail.user.firstname[0]}}. {{cocktail.user.lastname}}</td>
                        <td>{{cocktail.difficulty}}</td>
                        <td>
                            {% if cocktail.valid%}
                            <p class="fw-bolder text-success">Approved</p>
                            {% else %}
                            <p class="fw-bolder text-danger">Not approved</p>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{{ url_for('cocktail.details_cocktail', cocktail_id=cocktail.id) }}" class="btn btn-outline-warning"><i class="fas fa-eye"></i></a>
                            {% if cocktail.valid%}
                            <a href="/cocktail/desapprove/{{cocktail.id}}" class="btn btn-warning" onclick="return confirm('Are you sure to desapprouve?')">Desapprove</a>
                            {% else %}
                            <a href="/cocktail/approve/{{cocktail.id}}" class="btn btn-success" onclick="return confirm('Are you sure to approve?')">Approve</a>
                            {% endif %}
                            <a href="/cocktail/delete/{{cocktail.id}}" class="btn btn-danger" onclick="return confirm('Are you sure to delete?')">Delete</a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function(){
        document.getElementById('filter-form').addEventListener('submit', function(event){
            event.preventDefault(); 
            updateRow();
            
        });
    });
    function updateRow(){
        var status = document.getElementById('status-filter').value;
            var author = document.getElementById('author-filter').value;
            var difficulty = document.getElementById('difficulty-filter').value;

            fetch('/filter_cocktails', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    status: status,
                    author: author,
                    difficulty: difficulty
                })
            })
            .then(response => response.text())
            .then(data => {
                document.getElementById('filtered-results').innerHTML = data;
                console.log(data)
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
</script>

{% endblock %}
